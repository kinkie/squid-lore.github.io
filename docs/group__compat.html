<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Squid Web Cache: Portability Library</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Squid Web Cache<span id="projectnumber">&#160;v8/master</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('group__compat.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">Portability Library</div></div>
</div><!--header-->
<div class="contents">
<p>\title Squid Portability</p>
<h1><a class="anchor" id="sec1"></a>
Aim</h1>
<dl class="section user"><dt></dt><dd>Squid aims to build and run on many modern systems. To do this we have traditionally added small hacks and wrappers all over the code whenever one was needed. The final result of that is a vast amount of code duplication, dodgy licensing on some older hacks, and some cases of obsolete algorithms sitting side by side with their current equivalent.</dd></dl>
<dl class="section user"><dt></dt><dd>The Portability library libcompatsquid.la has been created to correct the three issues of stable build portability, code cleanliness, and clearer licensing.</dd></dl>
<h1><a class="anchor" id="sec2"></a>
Requirements</h1>
<dl class="section user"><dt></dt><dd>The system calls used by Squid are not required to be standard. Often we depend on some non-standard call which can give great performance benefits. But they are required to meet several other criteria: <ul>
<li>They must be of actual benefit to Squid during its operation. </li>
<li>A better alternative must not exist. </li>
<li>If not available on all OS an open-source GPLv2+ compatible implementation must be available to be included with the Squid sources and used when required.</li>
</ul>
</dd></dl>
<dl class="section user"><dt></dt><dd>To be built into the libcompatsquid.la as a layer below all Squid-bundled binaries. The code must also qualify by being provided natively by some OS where Squid builds. \br Code and Algorithms which do not meet this final criteria are relegated to the slightly higher level of basic component, rather than portability.</dd></dl>
<h1><a class="anchor" id="sec3"></a>
Component Types</h1>
<dl class="section user"><dt>Macro re-definition</dt><dd>Where the only difference between systems is their naming scheme. One of the schemes is chosen by the developers for use and mappings are created in the form of Macros.</dd></dl>
<dl class="section user"><dt>Inline Functions</dt><dd></dd></dl>
<dl class="section user"><dt>Algorithm Templates and Inline functions</dt><dd>Being C++ we are able to use templates in place of inline functions where that is more convenient. Care is taken to provide no additional requirements upon the callers when using the template as to when using the native constructs.</dd></dl>
<dl class="section user"><dt>Emulators</dt><dd>As mentioned above if a useful library function calls or global is not available on all operating systems a GPLv2+ alternative may be added to the compat layer. As an emulator it retains the exact naming and definition of the source systems. Thus being able to be used seamlessly across all platforms by the main code.</dd></dl>
<dl class="section user"><dt>Wrappers</dt><dd>Sometimes common and useful library functions are not always as safe as they could be. An alternative which wraps the original in extra safety checks is provided under the same name with an 'x' prepended. Currently these extra protections are added on string handling and memory allocation.</dd></dl>
<h1><a class="anchor" id="sec4"></a>
Layout</h1>
<p>The internal code structure of libcompatsquid.la files has a hierarchy. The API has a flat global scope separate from the file layout. The API is pulled in by including <a class="el" href="compat_8h.html">compat/compat.h</a>. The strict dependency requirements which exist within the compat API make including an individual part separately a risky operation.</p>
<dl class="section user"><dt></dt><dd>Squid coding guidelines require each .c and .cc file to include <a class="el" href="squid_8h.html">squid.h</a> first in their included files. <a class="el" href="squid_8h.html">squid.h</a> begins with an order-specific sequence of defines and includes <a class="el" href="compat_8h.html">compat/compat.h</a> to incorporate the compat layer appropriately in every source file.</dd></dl>
<dl class="section user"><dt></dt><dd>Internally the compat/ directory contains the public API file <a class="el" href="compat_8h.html">compat/compat.h</a> which structures order-specific includes as documented inside that file. Included by that is <a class="el" href="osdetect_8h.html">compat/osdetect.h</a> which determines which operating system and in some cases compiler is being used.</dd></dl>
<dl class="section user"><dt></dt><dd>The compat/os/ directory contains separate files for each supported system which requires special compat layer handling. Hacks for specific systems should be restricted to these files as much as possible.</dd></dl>
<dl class="section user"><dt></dt><dd><a class="el" href="compat__shared_8h.html">compat/compat_shared.h</a> file contains the portability definitions which are shared across a great many systems. These should be written with protective macros to prevent any symbols or code being defined which is not necessary. Protections here must not be system-specific.</dd></dl>
<dl class="section user"><dt></dt><dd>Also in compat/ directory are the .h and .c files for emulators detected by autoconf. These are added by autoconf to the build objects as required. </dd></dl>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
