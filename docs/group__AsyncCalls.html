<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Squid Web Cache: Asynchronous Calls</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Squid Web Cache<span id="projectnumber">&#160;v8/master</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('group__AsyncCalls.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">Asynchronous Calls<div class="ingroups"><a class="el" href="group__Components.html">Squid Components</a></div></div></div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Collaboration diagram for Asynchronous Calls:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="group__AsyncCalls.svg" width="352" height="36"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<h1><a class="anchor" id="Terminology"></a>
Terminology</h1>
<ul>
<li><b>Call:</b> an <a class="el" href="classAsyncCall.html">AsyncCall</a> object meant to be delivered from the Caller to the Recipient.</li>
<li><b>Recipient:</b> the code being the destination of the Call. The specific function receiving the call is often called "handler".</li>
<li><b>Caller:</b> the code scheduling or placing the Call.</li>
<li><b>Creator:</b> the code creating the Call.</li>
<li><b>Dialing:</b> the final act of delivering the Call to the Recipient.</li>
<li><b>Canceling:</b> preventing the call from being dialed in the future.</li>
<li><b>Pending call</b>: the call which has been scheduled but no attempt to dial it has been made.</li>
<li><b>Live call</b>: the in-progress call that has been dialed and the Recipient (receiving) function has not finished yet.</li>
</ul>
<h1><a class="anchor" id="Life"></a>
Typical life cycle</h1>
<ol type="1">
<li>Creator creates a Call object and stores its pointer, possibly in a temporary variable. If Creator is the future Recipient of the Call, it is customary to talk about a "callback". In such context, Creator gives the Call pointer to some other code (the future Caller). Calls are refcounted and the <a class="el" href="classAsyncCall.html#a57c571a47666d10c316689dc5d09e170">AsyncCall::Pointer</a> class must be used to point and share them.</li>
<li><a class="el" href="namespaceTime.html" title="Time and Date handling tools.">Time</a> passes and something triggers the need to dial the call.</li>
<li>Caller schedules (a.k.a, places) the Call. The Call is placed in the <a class="el" href="classAsyncCallQueue.html">AsyncCallQueue</a>. The queue preserves the scheduling call order.</li>
<li><a class="el" href="namespaceTime.html" title="Time and Date handling tools.">Time</a> passes and it is now time to dial the call.</li>
<li><a class="el" href="classAsyncCallQueue.html">AsyncCallQueue</a> checks whether the call can be dialed. If yes, <a class="el" href="classAsyncCallQueue.html">AsyncCallQueue</a> dials the Call and the Recipient receives it. Otherwise, only a debugging message is logged (if enabled). Dialing a call involves several state checks at several stages, depending on the Call type.</li>
<li>The Call is alive while the Recipient is handling it. That state ends when the Recipient code (a.k.a., handler) returns. At that point, the <a class="el" href="classAsyncCallQueue.html">AsyncCallQueue</a> proceeds to handle other calls.</li>
<li>The Call object is destroyed when the last reference to it is gone. One should not try to invalidate or delete the call.</li>
</ol>
<h1><a class="anchor" id="Rules"></a>
Basic rules</h1>
<ul>
<li>Callbacks must be called: If a Caller has a Call pointer as a callback, the Caller must make that Call when conditions are right (possibly with a call-specific error indicator). Whether that Call will be dialed is irrelevant here.</li>
<li>Unwanted calls must be canceled: If Recipient may not be able to handle the call back, then it must cancel it. Whether that Call will be scheduled is irrelevant here. If the Recipient has an <a class="el" href="classAsyncCall.html">AsyncCall</a> pointer, calling <a class="el" href="classAsyncCall.html#a7c1ca1dcfdb5961653d64edf51dc218d">AsyncCall::cancel</a> is sufficient, but the code should use call-specific APIs when possible (e.g., <a class="el" href="namespaceComm.html#a24de01312960dba5c38466509cadb831" title="Cancel the read pending on FD. No action if none pending.">Comm::ReadCancel</a> or comm_close).</li>
<li>Processed calls should be forgotten: If you scheduled, received, or cancel the call, set its pointer to NULL. The Caller should forget the call after scheduling it. the recipient should forget the call when it receives or cancels it. These are just cleanup rules to avoid double-scheduling or double-cancellation as well as situations where the code assumes it can still change a pending Call (which will not work for SMP code).</li>
<li>The calls are received in the order they were scheduled.</li>
<li>The Recipient is guaranteed to receive at most one Call at a time. An attempt to dial call B while some call A is alive is a bug, and call B will not be dialed.</li>
</ul>
<h1><a class="anchor" id="Canceling"></a>
Call Canceling</h1>
<ul>
<li>A call may be canceled at any time.</li>
<li>A canceled call will not be dialed.</li>
<li>Cancellation has immediate effect: The call will never be dialed after cancel() is called</li>
<li>Cancellation by non-Recipients is discouraged because it may not work in an SMP environment.</li>
<li>A late call cancellation is cancellation that is performed after the Call has already been dialed (i.e., the call is or was alive at the time of the cancellation). Late cancellation is a no-op. It is not a bug to cancel something late, but the canceling code should be aware of that possibility. </li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
